<!DOCTYPE html>
<html lang="en" data-root="https://acm.im/bristlecone/">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Andrew Martin" name="author">
    <!-- Opengraph properties (https://ogp.me/) -->
    <meta property="og:site_name" content="bristlecone">
    <meta property="og:title" content="Diagnostics" />
    <meta property="og:url" content="https://acm.im/bristlecone/diagnostics.html">
    <meta property="og:type" content="website" />
    <!-- Twitter cards (https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/summary-card-with-large-image) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="https://acm.im/bristlecone/">
    <meta name="twitter:title" content="Diagnostics">
    
    <title>Diagnostics | bristlecone</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://acm.im/bristlecone/img/favicon.ico" rel="icon" sizes="32x32" type="image/png"/>
    <script type="application/javascript" src="https://acm.im/bristlecone/content/fsdocs-theme-set-dark.js"></script>
    <script type="application/javascript" src="https://acm.im/bristlecone/content/fsdocs-details-set-expanded.js"></script>
    <link href="https://acm.im/bristlecone/content/fsdocs-default.css" rel="stylesheet" type="text/css"/>
    <link href="https://acm.im/bristlecone/content/fsdocs-theme.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.plot.ly/plotly-2.21.0.min.js"></script>
    
</head>
<body class="content">
<header>
    <div class="start">
        <div id="menu-toggle">
            <iconify-icon class="icon closed" height="22" icon="eva:menu-fill" width="22"></iconify-icon>
            <iconify-icon class="icon open" height="22" icon="mi:close" width="22"></iconify-icon>
            <input type="checkbox" name="mobile-menu" />
            <ul class="menu">
                <li class="nav-header">Links</li>
                <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/blob/master/LICENSE">License</a>
                </li>
                <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                        href="https://github.com/AndrewIOM/bristlecone/blob/master/RELEASE_NOTES.MD">Release
                    Notes</a></li>
                <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/">Source
                    Repository</a></li>
                <li class="nav-header ">
  The Bristlecone Language
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/language.html">
    Writing Models
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model.html">
    Defining a Hypothesis (or Model System)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/estimation-engine.html">
    Defining a Model-Fitting Method (Estimation Engine)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/composing-models.html">
    Composing models into many hypotheses
  </a>
</li>             
<li class="nav-header active">
  Techniques
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-fitting.html">
    Model Fitting
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-selection.html">
    Model Selection
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/workflow.html">
    Ensembles and Parallel Processing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/confidence-intervals.html">
    Calculating Confidence Intervals
  </a>
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://acm.im/bristlecone/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/data.html">
    Loading and Saving Data
  </a>
</li>             
<li class="nav-header ">
  Bristlecone.Dendro
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/dendro.html">
    Dendroecology
  </a>
</li>             
<li class="nav-header ">
  Examples
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/predator-prey.html">
    Predator-Prey Dynamics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/sedimentary.html">
    The long-term ecological detective: Holocene ecosystem functioning
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/dendroecology.html">
    Wood rings: investigating plant-environment interactions
  </a>
</li>             
<li class="nav-header ">
  Components
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/optimisation.html">
    Optimisation
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/time-series.html">
    Time-Series and Time-Frames
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/integration.html">
    Integration
  </a>
</li>             
<li class="nav-header ">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/data/dendro/readme.html">
    readme
  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://acm.im/bristlecone/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
        <a href="https://acm.im/bristlecone/">
            <img alt="Header menu logo" src="https://acm.im/bristlecone//img/logo.png">
            <strong>bristlecone</strong>
        </a>
    </div>
    <div class="end">
        <a href="https://github.com/AndrewIOM/bristlecone/" target="_blank">
            <iconify-icon icon="uil:github" width="26" height="26"></iconify-icon>
        </a>
        <iconify-icon id="search-btn" icon="carbon:search" class="search" width="24" height="24"></iconify-icon>
        <fsdocs-theme-toggle></fsdocs-theme-toggle>
    </div>
</header>
<aside id="fsdocs-main-menu">
    <ul class="menu">
        <li class="nav-header">Links</li>
        <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/blob/master/LICENSE">License</a>
        </li>
        <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                href="https://github.com/AndrewIOM/bristlecone/blob/master/RELEASE_NOTES.MD">Release
            Notes</a></li>
        <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/">Source
            Repository</a></li>
        <li class="nav-header ">
  The Bristlecone Language
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/language.html">
    Writing Models
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model.html">
    Defining a Hypothesis (or Model System)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/estimation-engine.html">
    Defining a Model-Fitting Method (Estimation Engine)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/composing-models.html">
    Composing models into many hypotheses
  </a>
</li>             
<li class="nav-header active">
  Techniques
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-fitting.html">
    Model Fitting
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-selection.html">
    Model Selection
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/workflow.html">
    Ensembles and Parallel Processing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/confidence-intervals.html">
    Calculating Confidence Intervals
  </a>
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://acm.im/bristlecone/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/data.html">
    Loading and Saving Data
  </a>
</li>             
<li class="nav-header ">
  Bristlecone.Dendro
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/dendro.html">
    Dendroecology
  </a>
</li>             
<li class="nav-header ">
  Examples
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/predator-prey.html">
    Predator-Prey Dynamics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/sedimentary.html">
    The long-term ecological detective: Holocene ecosystem functioning
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/dendroecology.html">
    Wood rings: investigating plant-environment interactions
  </a>
</li>             
<li class="nav-header ">
  Components
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/optimisation.html">
    Optimisation
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/time-series.html">
    Time-Series and Time-Frames
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/integration.html">
    Integration
  </a>
</li>             
<li class="nav-header ">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/data/dendro/readme.html">
    readme
  </a>
</li>
        <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://acm.im/bristlecone/reference/index.html">
    All Namespaces
  </a>
</li>
    </ul>
</aside>
<main>
    <div id="content">
        
<p><a href="https://acm.im/bristlecone//diagnostics.fsx"><img src="https://acm.im/bristlecone//img/badge-script.svg" alt="Script" /></a>&emsp;
<a href="https://acm.im/bristlecone//diagnostics.ipynb"><img src="https://acm.im/bristlecone//img/badge-notebook.svg" alt="Notebook" /></a></p>
<h1><a name="Diagnostics" class="anchor" href="#Diagnostics">Diagnostics</a></h1>
<p>Diagnostic statistics are essential to ensure that the model-fitting
and model-selection results are valid and complete.</p>
<h3><a name="Convergence-Statistics" class="anchor" href="#Convergence-Statistics">Convergence Statistics</a></h3>
<p>For Monte-Carlo based optimisation techniques (such as the random walk
MCMC or the Filzbach-style MCMC) convergence statistics are useful to
assess whether multiple independent <em>chains</em> have identified the same
minimum -log likelihood in parameter space, which may be the global minimum.</p>
<p>Bristlecone includes the Gelman-Rubin convergence statistic (Rhat), which
can be calculated on a per-parameter basis.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">Bristlecone</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="m">Diagnostics</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="id">Data</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="id">saveDirectory</span> <span class="o">=</span> <span class="s">&quot;/some/save/dir&quot;</span>

<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="fn">listOfResults</span> <span class="k">-&gt;</span>

    <span class="c">// Calculate Gelman-Rubin statistic for all parameters</span>
    <span class="c">// across multiple model runs</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="fn">stat</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="m">Convergence</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="id">gelmanRubinAll</span> <span class="n">1000</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">_</span> <span class="k">-&gt;</span> <span class="s">&quot;some subject&quot;</span><span class="pn">)</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">_</span> <span class="k">-&gt;</span> <span class="s">&quot;some hypothesis&quot;</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs5', 11)" onmouseover="showTip(event, 'fs5', 11)" class="fn">listOfResults</span>

    <span class="c">// Save results to a single file</span>
    <span onmouseout="hideTip(event, 'fs7', 12)" onmouseover="showTip(event, 'fs7', 12)" class="m">Convergence</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="id">save</span> <span onmouseout="hideTip(event, 'fs4', 14)" onmouseover="showTip(event, 'fs4', 14)" class="id">saveDirectory</span> <span onmouseout="hideTip(event, 'fs6', 15)" onmouseover="showTip(event, 'fs6', 15)" class="fn">stat</span>
</code></pre>
<h3><a name="Logging-individual-model-components" class="anchor" href="#Logging-individual-model-components">Logging individual model components</a></h3>
<p>Sometimes it is helpful for diagnostic or visualisation purposes to
see the values of individual parts of a mathematical model during
computation, or at the minimum -log likelihood.</p>
<p>Bristlecone includes the ability to log out the values of individual
model components through time. An worked example is given below of how to
obtain computed values across the time-series for components within
a model system. First, you must set up a model that has a parameter
of the <code>IComponentLogger&lt;float&gt;)</code> type:</p>
<p>[ NB TODO: This function must be refactored to work with the new v2 Bristlecone Language,
and as such is currently disabled. ]</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// open Bristlecone</span>
<span class="c">// open Bristlecone.Language</span>
<span class="c">// open Bristlecone.Diagnostics.ModelComponents</span>

<span class="c">// let hypothesis (cLog:IComponentLogger&lt;ModelExpression&gt;) =</span>

<span class="c">//     let ``dN/dt`` =</span>
<span class="c">//         Parameter &quot;r&quot; * This * cLog.StoreValue &quot;log this thing&quot; (Constant 1. - (This / Parameter &quot;K&quot;))</span>

<span class="c">//     Model.empty</span>
<span class="c">//     |&gt; Model.addEquation       &quot;N&quot;      ``dN/dt``</span>
<span class="c">//     |&gt; Model.estimateParameter &quot;r&quot;      noConstraints 0.10 5.00</span>
<span class="c">//     |&gt; Model.estimateParameter &quot;K&quot;      noConstraints 50.0 150.</span>
<span class="c">//     |&gt; Model.useLikelihoodFunction      (ModelLibrary.Likelihood.sumOfSquares [ &quot;N&quot; ])</span>
<span class="c">//     |&gt; Model.compile</span>


<span class="c">// fun engine singleResult -&gt;</span>
<span class="c">//     // A wrapper around the Bristlecone.fit function</span>
<span class="c">//     let fitFn ts m e = Bristlecone.fit e (Optimisation.EndConditions.afterIteration 1) ts m</span>
<span class="c">//     let logs = ModelComponents.calculateComponents fitFn engine singleResult</span>
<span class="c">//     ()</span>
</code></pre>

        <div class="fsdocs-tip" id="fs1">Multiple items<br />module Bristlecone

from Bristlecone<br /><em>&lt;namespacedoc&gt;&lt;summary&gt;The core library of Bristlecone, containing model-fitting functions.&lt;/summary&gt;&lt;/namespacedoc&gt;<br />

 Main functionality of Bristlecone, including functions to scaffold
 `ModelSystem`s and for model-fitting (tests and real fits).
</em><br /><br />--------------------<br />namespace Bristlecone</div>
<div class="fsdocs-tip" id="fs2">module Diagnostics

from Bristlecone<br /><em>&lt;summary&gt;Diagnostic techniques for determining the suitability of
 results obtained with Bristlecone.&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs3">namespace Bristlecone.Data</div>
<div class="fsdocs-tip" id="fs4">val saveDirectory: string</div>
<div class="fsdocs-tip" id="fs5">val listOfResults: ModelSelection.ResultSet.ResultSet&lt;&#39;a,&#39;b,&#39;c,&#39;d,&#39;e&gt; seq</div>
<div class="fsdocs-tip" id="fs6">val stat: Convergence.ConvergenceStatistic seq</div>
<div class="fsdocs-tip" id="fs7">Multiple items<br />module Convergence

from Bristlecone.Data<br /><br />--------------------<br />module Convergence

from Bristlecone.Diagnostics<br /><em>&lt;summary&gt;Convergence diagnostics for monte-carlo markov chain (MCMC) analyses.&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs8">val gelmanRubinAll: nMostRecent: int -&gt; subject: (&#39;subject -&gt; string) -&gt; hypothesis: (&#39;hypothesis -&gt; string) -&gt; results: ModelSelection.ResultSet.ResultSet&lt;&#39;subject,&#39;hypothesis,&#39;date,&#39;timeunit,&#39;timespan&gt; seq -&gt; Convergence.ConvergenceStatistic seq<br /><em>&lt;summary&gt;Calculate the Gelman-Rubin statistic for each parameter in all of the given
 `ResultSet`. The statistic tends downwards to one, with one indicating
 perfect convergence between all chains.&lt;/summary&gt;<br />&lt;param name=&quot;nMostRecent&quot;&gt;How many recent iterations to use from the trace.&lt;/param&gt;<br />&lt;param name=&quot;subject&quot;&gt;A function to retrieve a subject ID from a subject&lt;/param&gt;<br />&lt;param name=&quot;hypothesis&quot;&gt;A function to retrieve a hypothesis ID from a hypothesis&lt;/param&gt;<br />&lt;param name=&quot;result&quot;&gt;A result set (of 1 .. many results) for a particular subject and hypothesis&lt;/param&gt;<br />&lt;returns&gt;If more than one replicate, the R-hat convergence statistic across replicates&lt;/returns&gt;</em></div>
<div class="fsdocs-tip" id="fs9">val save: directory: string -&gt; result: Convergence.ConvergenceStatistic seq -&gt; unit</div>

    </div>
</main>
<aside id="fsdocs-page-menu">
    <p id="on-this-page">On this page</p>
    <ul>
  <li class="level-1">
    <a href="#Diagnostics">
      Diagnostics
    </a>
  </li>
  <li class="level-3">
    <a href="#Convergence-Statistics">
      Convergence Statistics
    </a>
  </li>
  <li class="level-3">
    <a href="#Logging-individual-model-components">
      Logging individual model components
    </a>
  </li>
</ul>
</aside>
<dialog>
    <input type="search" placeholder="Search docs" />
    <div class="results">
        <ul></ul>
        <p class="empty">Type something to start searching.</p>
    </div>
</dialog>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-tips.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-theme-toggle.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-details-toggle.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-theme.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-search.js"></script>

</body>
</html>