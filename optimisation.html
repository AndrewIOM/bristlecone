<!DOCTYPE html>
<html lang="en" data-root="https://acm.im/bristlecone/">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Andrew Martin" name="author">
    <!-- Opengraph properties (https://ogp.me/) -->
    <meta property="og:site_name" content="bristlecone">
    <meta property="og:title" content="Optimisation" />
    <meta property="og:url" content="https://acm.im/bristlecone/optimisation.html">
    <meta property="og:type" content="website" />
    <!-- Twitter cards (https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/summary-card-with-large-image) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="https://acm.im/bristlecone/">
    <meta name="twitter:title" content="Optimisation">
    
    <title>Optimisation | bristlecone</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://acm.im/bristlecone/img/favicon.ico" rel="icon" sizes="32x32" type="image/png"/>
    <script type="application/javascript" src="https://acm.im/bristlecone/content/fsdocs-theme-set-dark.js"></script>
    <script type="application/javascript" src="https://acm.im/bristlecone/content/fsdocs-details-set-expanded.js"></script>
    <link href="https://acm.im/bristlecone/content/fsdocs-default.css" rel="stylesheet" type="text/css"/>
    <link href="https://acm.im/bristlecone/content/fsdocs-theme.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.plot.ly/plotly-2.21.0.min.js"></script>
    
</head>
<body class="content">
<header>
    <div class="start">
        <div id="menu-toggle">
            <iconify-icon class="icon closed" height="22" icon="eva:menu-fill" width="22"></iconify-icon>
            <iconify-icon class="icon open" height="22" icon="mi:close" width="22"></iconify-icon>
            <input type="checkbox" name="mobile-menu" />
            <ul class="menu">
                <li class="nav-header">Links</li>
                <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/blob/master/LICENSE">License</a>
                </li>
                <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                        href="https://github.com/AndrewIOM/bristlecone/blob/master/RELEASE_NOTES.MD">Release
                    Notes</a></li>
                <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/">Source
                    Repository</a></li>
                <li class="nav-header ">
  The Bristlecone Language
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/language.html">
    Writing Models
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model.html">
    Defining a Hypothesis (or Model System)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/estimation-engine.html">
    Defining a Model-Fitting Method (Estimation Engine)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/composing-models.html">
    Composing models into many hypotheses
  </a>
</li>             
<li class="nav-header ">
  Techniques
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-fitting.html">
    Model Fitting
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-selection.html">
    Model Selection
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/workflow.html">
    Ensembles and Parallel Processing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/confidence-intervals.html">
    Calculating Confidence Intervals
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/data.html">
    Loading and Saving Data
  </a>
</li>             
<li class="nav-header ">
  Bristlecone.Dendro
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/dendro.html">
    Dendroecology
  </a>
</li>             
<li class="nav-header ">
  Examples
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/predator-prey.html">
    Predator-Prey Dynamics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/sedimentary.html">
    The long-term ecological detective: Holocene ecosystem functioning
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/dendroecology.html">
    Wood rings: investigating plant-environment interactions
  </a>
</li>             
<li class="nav-header active">
  Components
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://acm.im/bristlecone/optimisation.html">
    Optimisation
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/time-series.html">
    Time-Series and Time-Frames
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/integration.html">
    Integration
  </a>
</li>             
<li class="nav-header ">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/data/dendro/readme.html">
    readme
  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://acm.im/bristlecone/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
        <a href="https://acm.im/bristlecone/">
            <img alt="Header menu logo" src="https://acm.im/bristlecone//img/logo.png">
            <strong>bristlecone</strong>
        </a>
    </div>
    <div class="end">
        <a href="https://github.com/AndrewIOM/bristlecone/" target="_blank">
            <iconify-icon icon="uil:github" width="26" height="26"></iconify-icon>
        </a>
        <iconify-icon id="search-btn" icon="carbon:search" class="search" width="24" height="24"></iconify-icon>
        <fsdocs-theme-toggle></fsdocs-theme-toggle>
    </div>
</header>
<aside id="fsdocs-main-menu">
    <ul class="menu">
        <li class="nav-header">Links</li>
        <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/blob/master/LICENSE">License</a>
        </li>
        <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                href="https://github.com/AndrewIOM/bristlecone/blob/master/RELEASE_NOTES.MD">Release
            Notes</a></li>
        <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/">Source
            Repository</a></li>
        <li class="nav-header ">
  The Bristlecone Language
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/language.html">
    Writing Models
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model.html">
    Defining a Hypothesis (or Model System)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/estimation-engine.html">
    Defining a Model-Fitting Method (Estimation Engine)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/composing-models.html">
    Composing models into many hypotheses
  </a>
</li>             
<li class="nav-header ">
  Techniques
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-fitting.html">
    Model Fitting
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-selection.html">
    Model Selection
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/workflow.html">
    Ensembles and Parallel Processing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/confidence-intervals.html">
    Calculating Confidence Intervals
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/data.html">
    Loading and Saving Data
  </a>
</li>             
<li class="nav-header ">
  Bristlecone.Dendro
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/dendro.html">
    Dendroecology
  </a>
</li>             
<li class="nav-header ">
  Examples
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/predator-prey.html">
    Predator-Prey Dynamics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/sedimentary.html">
    The long-term ecological detective: Holocene ecosystem functioning
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/dendroecology.html">
    Wood rings: investigating plant-environment interactions
  </a>
</li>             
<li class="nav-header active">
  Components
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://acm.im/bristlecone/optimisation.html">
    Optimisation
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/time-series.html">
    Time-Series and Time-Frames
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/integration.html">
    Integration
  </a>
</li>             
<li class="nav-header ">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/data/dendro/readme.html">
    readme
  </a>
</li>
        <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://acm.im/bristlecone/reference/index.html">
    All Namespaces
  </a>
</li>
    </ul>
</aside>
<main>
    <div id="content">
        
<p><a href="https://acm.im/bristlecone//optimisation.fsx"><img src="https://acm.im/bristlecone//img/badge-script.svg" alt="Script" /></a>&emsp;
<a href="https://acm.im/bristlecone//optimisation.ipynb"><img src="https://acm.im/bristlecone//img/badge-notebook.svg" alt="Notebook" /></a></p>
<h1><a name="Optimisation-Methods" class="anchor" href="#Optimisation-Methods">Optimisation Methods</a></h1>
<p>Bristlecone includes a suite of in-built local and global
optimisation methods. You can also use a custom optimisation
method defined in another library, or combine these with the
in-built optimisation techniques.</p>
<h2><a name="Defining-a-custom-optimisation-method" class="anchor" href="#Defining-a-custom-optimisation-method">Defining a custom optimisation method</a></h2>
<p>A custom optimisation
procedure can be used with Bristlecone by plugging in as follows:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">Bristlecone</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">myCustomOptimiser</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="m">EstimationEngine</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="m">Optimisation</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="id">Optimiser</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="m">EstimationEngine</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="m">Optimisation</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="id">InDetachedSpace</span>
    <span class="o">&lt;|</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="fn">writeOut</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="fn">n</span> <span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="fn">domain</span> <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="fn">f</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="fn">invalidOp</span> <span class="s">&quot;Doesn&#39;t actually do anything!&quot;</span>

<span onmouseout="hideTip(event, 'fs1', 14)" onmouseover="showTip(event, 'fs1', 14)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="id">mkContinuous</span> <span class="pn">(</span><span class="pn">)</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs1', 16)" onmouseover="showTip(event, 'fs1', 16)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="id">withCustomOptimisation</span> <span onmouseout="hideTip(event, 'fs2', 18)" onmouseover="showTip(event, 'fs2', 18)" class="id">myCustomOptimiser</span>
</code></pre>
<h2><a name="Included-optimisation-methods" class="anchor" href="#Included-optimisation-methods">Included optimisation methods</a></h2>
<p>The library itself includes Monte Carlo-based methods, and Amoeba (Nelder Mead Simplex) methods.
All methods are included in this namespace:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 19)" onmouseover="showTip(event, 'fs1', 19)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 20)" onmouseover="showTip(event, 'fs14', 20)" class="id">Optimisation</span>
</code></pre>
<h3><a name="Simulated-Annealing-SA" class="anchor" href="#Simulated-Annealing-SA">Simulated Annealing (SA)</a></h3>
<p>Simulated annealing models a minimisation problem in terms of particle
entropy, where the function value is analogous to energy. At high
temperatures, particles are in a high-energy state, thus can move
readily. As temperature gradually decreases, particles are less able
to move to high energy states, with particles eventually arranging
into the ‘ground state’ of a solid material.</p>
<p>The SA implementation in Bristlecone includes classical SA that uses
a Boltzmann machine for jumps, and fast simulated annealing (FSA) that
uses a Cauchy distribution for jumps:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 21)" onmouseover="showTip(event, 'fs15', 21)" class="id">settings</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 23)" onmouseover="showTip(event, 'fs17', 23)" class="m">SimulatedAnnealing</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs18', 24)" onmouseover="showTip(event, 'fs18', 24)" class="rt">AnnealSettings</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs19', 25)" onmouseover="showTip(event, 'fs19', 25)" class="id">Default</span>

<span class="c">// Classical Simulated Annealing:</span>
<span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 27)" onmouseover="showTip(event, 'fs17', 27)" class="m">SimulatedAnnealing</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs20', 28)" onmouseover="showTip(event, 'fs20', 28)" class="id">classicalSimulatedAnnealing</span> <span class="n">0.01</span><span class="pn">&lt;</span><span class="rt">``optim-space``</span><span class="pn">&gt;</span> <span class="k">false</span> <span onmouseout="hideTip(event, 'fs15', 29)" onmouseover="showTip(event, 'fs15', 29)" class="id">settings</span>

<span class="c">// Fast Simulated Annealing:</span>
<span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 31)" onmouseover="showTip(event, 'fs17', 31)" class="m">SimulatedAnnealing</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 32)" onmouseover="showTip(event, 'fs21', 32)" class="id">fastSimulatedAnnealing</span> <span class="n">0.01</span><span class="pn">&lt;</span><span class="rt">``optim-space``</span><span class="pn">&gt;</span> <span class="k">false</span> <span onmouseout="hideTip(event, 'fs15', 33)" onmouseover="showTip(event, 'fs15', 33)" class="id">settings</span>
</code></pre>
<p>The FSA approach enables greater exploration of more distant portions of
parameter space more quickly and is therefore less prone to local minima
problems.</p>
<p>For the SA implementation in Bristlecone, you must specify whether you
wish to use a temperature-dependent or temperature-independent proposal.
When temperature-dependent, the jump size increases at higher temperatures,
allowing coarser exploration of the parameter space initially, progressively
becoming more refined as the system cools.</p>
<h3><a name="Nelder-Mead-Methods" class="anchor" href="#Nelder-Mead-Methods">Nelder-Mead Methods</a></h3>
<p>The Nelder-Mead simplex (or amoeba method) expands and contracts an n-dimensional
geometry within an unconstrained parameter space, following a
‘downhill’ gradient. The implementation here draws a random point from a
normal distribution, informed by the starting bounds for each parameter.</p>
<p>The Nelder-Mead simplex is most appropriate for simpler likelihood surfaces.
It can be used as follows:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 34)" onmouseover="showTip(event, 'fs22', 34)" class="id">settingsNM</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 35)" onmouseover="showTip(event, 'fs23', 35)" class="m">Amoeba</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs24', 36)" onmouseover="showTip(event, 'fs24', 36)" class="m">Solver</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs25', 37)" onmouseover="showTip(event, 'fs25', 37)" class="id">Default</span>
</code></pre>
<table class="pre"><tr><td><pre><code>{ Alpha = 1.0
  Sigma = 0.5
  Gamma = 2.0
  Rho = 0.5
  Size = 3 }</code></pre></td></tr></table>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 38)" onmouseover="showTip(event, 'fs26', 38)" class="fn">single</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs3', 39)" onmouseover="showTip(event, 'fs3', 39)" class="m">EstimationEngine</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs4', 40)" onmouseover="showTip(event, 'fs4', 40)" class="m">Optimisation</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs27', 41)" onmouseover="showTip(event, 'fs27', 41)" class="id">Optimise</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 42)" onmouseover="showTip(event, 'fs23', 42)" class="m">Amoeba</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs24', 43)" onmouseover="showTip(event, 'fs24', 43)" class="m">Solver</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs28', 44)" onmouseover="showTip(event, 'fs28', 44)" class="id">solve</span> <span onmouseout="hideTip(event, 'fs22', 45)" onmouseover="showTip(event, 'fs22', 45)" class="id">settingsNM</span>
</code></pre>
<p>A single Nelder-Mead solver is highly subject to local minima. To reduce
the prevalence of local minima, Bristlecone includes a <em>swarm</em> implementation
of the Nelder-Mead simplex, which, creates an ensemble of 20 amoeba, all of which
crawl the likelihood surface. After n iterations, all amoeba that have values
above the 80th percentile of the negative log likelihood values are
discarded. The procedure continues for five levels. The swarm mode
can be used from:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 46)" onmouseover="showTip(event, 'fs29', 46)" class="id">levels</span> <span class="o">=</span> <span class="n">5</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 47)" onmouseover="showTip(event, 'fs30', 47)" class="id">individuals</span> <span class="o">=</span> <span class="n">20</span>

<span onmouseout="hideTip(event, 'fs23', 48)" onmouseover="showTip(event, 'fs23', 48)" class="m">Amoeba</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs31', 49)" onmouseover="showTip(event, 'fs31', 49)" class="id">swarm</span> <span onmouseout="hideTip(event, 'fs29', 50)" onmouseover="showTip(event, 'fs29', 50)" class="id">levels</span> <span onmouseout="hideTip(event, 'fs30', 51)" onmouseover="showTip(event, 'fs30', 51)" class="id">individuals</span> <span onmouseout="hideTip(event, 'fs22', 52)" onmouseover="showTip(event, 'fs22', 52)" class="id">settingsNM</span>
</code></pre>
<h3><a name="Monte-Carlo-methods" class="anchor" href="#Monte-Carlo-methods">Monte Carlo methods</a></h3>
<p>Monte Carlo Markov Chain (MCMC) methods are most often applied in Bayesian
analyses, but can also be used for optimisation to identify the -log likelihood.
Within Bristlecone, a number of variations of Monte Carlo methods are included.</p>
<p>Often, it is appropriate to use multiple methods in combination; initially, tuning
algorithm(s) are used to enhance the performance of the search. Once the tuning phase
is complete, a search is conducted to identify the minimum; finally, a sampling algorithm
may be run to explore the distribution around the minimum.</p>
<h4><a name="Random-Walk-Metropolis-Hastings" class="anchor" href="#Random-Walk-Metropolis-Hastings">Random Walk Metropolis Hastings</a></h4>
<p>The random walk algorithm may optionally be passed a list of <code>TuningStep</code>s,
which will be run before the final random walk.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 53)" onmouseover="showTip(event, 'fs1', 53)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 54)" onmouseover="showTip(event, 'fs14', 54)" class="id">Optimisation</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs16', 55)" onmouseover="showTip(event, 'fs16', 55)" class="m">MonteCarlo</span>

<span class="c">// Random walk with no tuning steps</span>
<span onmouseout="hideTip(event, 'fs16', 56)" onmouseover="showTip(event, 'fs16', 56)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs32', 57)" onmouseover="showTip(event, 'fs32', 57)" class="id">randomWalk</span> <span class="pn">[</span><span class="pn">]</span>

<span class="c">// Random walk with 50,000 iterations of tuning, during</span>
<span class="c">// which the individual parameter jump sizes are scaled</span>
<span class="c">// every 500 iterations.</span>
<span class="pn">[</span> <span class="pn">{</span> <span class="prop">Method</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 58)" onmouseover="showTip(event, 'fs16', 58)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs33', 59)" onmouseover="showTip(event, 'fs33', 59)" class="rt">TuneMethod</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs34', 60)" onmouseover="showTip(event, 'fs34', 60)" class="id">Scale</span>
    <span class="prop">Frequency</span> <span class="o">=</span> <span class="n">500</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs35', 61)" onmouseover="showTip(event, 'fs35', 61)" class="rt">iteration</span><span class="pn">&gt;</span>
    <span class="fn">EndCondition</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 62)" onmouseover="showTip(event, 'fs36', 62)" class="m">EndConditions</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs37', 63)" onmouseover="showTip(event, 'fs37', 63)" class="id">atIteration</span> <span class="n">50000</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs35', 64)" onmouseover="showTip(event, 'fs35', 64)" class="rt">iteration</span><span class="pn">&gt;</span> <span class="pn">}</span> <span class="pn">]</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 65)" onmouseover="showTip(event, 'fs16', 65)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs32', 66)" onmouseover="showTip(event, 'fs32', 66)" class="id">randomWalk</span>
</code></pre>
<h4><a name="Adaptive-Metropolis-AM" class="anchor" href="#Adaptive-Metropolis-AM">Adaptive Metropolis (AM)</a></h4>
<p>The AM algorithm continuously tunes the covariance structure of the
jump distribution based on the size of jumps in the recently-explored
parameter space.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 67)" onmouseover="showTip(event, 'fs38', 67)" class="id">weighting</span> <span class="o">=</span> <span class="n">0.250</span> <span class="c">// Weight to give to recent history versus existing covariance structure</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 68)" onmouseover="showTip(event, 'fs39', 68)" class="id">frequency</span> <span class="o">=</span> <span class="n">200</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs35', 69)" onmouseover="showTip(event, 'fs35', 69)" class="rt">iteration</span><span class="pn">&gt;</span> <span class="c">// Tune the covariance structure every 200 iterations</span>

<span onmouseout="hideTip(event, 'fs16', 70)" onmouseover="showTip(event, 'fs16', 70)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs40', 71)" onmouseover="showTip(event, 'fs40', 71)" class="id">adaptiveMetropolis</span> <span onmouseout="hideTip(event, 'fs38', 72)" onmouseover="showTip(event, 'fs38', 72)" class="id">weighting</span> <span onmouseout="hideTip(event, 'fs39', 73)" onmouseover="showTip(event, 'fs39', 73)" class="id">frequency</span>
</code></pre>
<h4><a name="Filzbach-style-Monte-Carlo" class="anchor" href="#Filzbach-style-Monte-Carlo">Filzbach-style Monte Carlo</a></h4>
<p>The Filzbach algorithm was introduced by Drew Purves, Microsoft Research
Cambridge. The Filzbach algorithm was designed for problems in ecological
research. It contains a burn-in phase and a sampling phase.
Four settings are required: the length of the burn-in phase (which can be
any Bristlecone <code>EndCondition</code>); the minimum and maximum scale changes that can
occur within the tuning phase, based on the ranges given for each parameter in
the model definition; and the number of changes after which to conduct parameter
tuning.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 74)" onmouseover="showTip(event, 'fs1', 74)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 75)" onmouseover="showTip(event, 'fs14', 75)" class="id">Optimisation</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs16', 76)" onmouseover="showTip(event, 'fs16', 76)" class="m">MonteCarlo</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs41', 77)" onmouseover="showTip(event, 'fs41', 77)" class="m">Filzbach</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 78)" onmouseover="showTip(event, 'fs42', 78)" class="id">settingsFB</span> <span class="o">=</span>
    <span class="pn">{</span> <span class="prop">TuneAfterChanges</span> <span class="o">=</span> <span class="n">20</span>
      <span class="prop">MaxScaleChange</span> <span class="o">=</span> <span class="n">100.</span>
      <span class="prop">MinScaleChange</span> <span class="o">=</span> <span class="n">0.01</span>
      <span class="fn">BurnLength</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 79)" onmouseover="showTip(event, 'fs36', 79)" class="m">EndConditions</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs37', 80)" onmouseover="showTip(event, 'fs37', 80)" class="id">atIteration</span> <span class="n">100000</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs35', 81)" onmouseover="showTip(event, 'fs35', 81)" class="rt">iteration</span><span class="pn">&gt;</span> <span class="pn">}</span>

<span onmouseout="hideTip(event, 'fs43', 82)" onmouseover="showTip(event, 'fs43', 82)" class="fn">filzbach</span> <span onmouseout="hideTip(event, 'fs42', 83)" onmouseover="showTip(event, 'fs42', 83)" class="id">settingsFB</span>
</code></pre>
<h4><a name="Automatic-optimisation" class="anchor" href="#Automatic-optimisation">'Automatic' optimisation</a></h4>
<p>Implementation similar to that proposed by Yang and Rosenthal: "Automatically Tuned
General-Purpose MCMC via New Adaptive Diagnostics"
<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.70.7198&amp;rep=rep1&amp;type=pdf">Reference</a></p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs16', 84)" onmouseover="showTip(event, 'fs16', 84)" class="m">MonteCarlo</span><span class="pn">.</span><span class="id">``Automatic (Adaptive Diagnostics)``</span>
</code></pre>
<h4><a name="Adaptive-Metropolis-within-Gibbs" class="anchor" href="#Adaptive-Metropolis-within-Gibbs">Adaptive-Metropolis-within Gibbs</a></h4>
<p>An adaptive Metropolis-within-Gibbs sampler that tunes the variance of
each parameter according to the per-parameter acceptance rate.
Reference: Bai Y (2009). “An Adaptive Directional Metropolis-within-Gibbs Algorithm.”
Technical Report in Department of Statistics at the University of Toronto.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs16', 85)" onmouseover="showTip(event, 'fs16', 85)" class="m">MonteCarlo</span><span class="pn">.</span><span class="id">``Adaptive-Metropolis-within Gibbs``</span>
</code></pre>
<h4><a name="Metropolis-within-Gibbs" class="anchor" href="#Metropolis-within-Gibbs">Metropolis-within Gibbs</a></h4>
<p>A non-adaptive Metropolis-within-gibbs Sampler. Each parameter
is updated individually, unlike the random walk algorithm.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs16', 86)" onmouseover="showTip(event, 'fs16', 86)" class="m">MonteCarlo</span><span class="pn">.</span><span class="id">``Metropolis-within Gibbs``</span>
</code></pre>

        <div class="fsdocs-tip" id="fs1">Multiple items<br />module Bristlecone

from Bristlecone<br /><em>&lt;namespacedoc&gt;&lt;summary&gt;The core library of Bristlecone, containing model-fitting functions.&lt;/summary&gt;&lt;/namespacedoc&gt;<br />

 Main functionality of Bristlecone, including functions to scaffold
 `ModelSystem`s and for model-fitting (tests and real fits).
</em><br /><br />--------------------<br />namespace Bristlecone</div>
<div class="fsdocs-tip" id="fs2">val myCustomOptimiser: EstimationEngine.Optimisation.Optimiser</div>
<div class="fsdocs-tip" id="fs3">module EstimationEngine

from Bristlecone<br /><em>&lt;summary&gt;
 The estimation engine represents the method used to
 calculate equations and optimise a likelihood function.
 The whole estimation engine is tensor-based internally,
 but may take float-based equations as a legacy option.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs4">module Optimisation

from Bristlecone.EstimationEngine</div>
<div class="fsdocs-tip" id="fs5">type Optimiser =
  | InTransformedSpace of Optimise
  | InDetachedSpace of Optimise<br /><em>&lt;summary&gt;
 An `Optimiser` is an optimisation algorithm that may work either
 in &#39;transformed&#39; parameter space (where parameter constraints are
 automatically handled) or in &#39;detatched&#39; space (where the optimisation
 algorithm is responsible for respecting parameter constraints).
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs6">union case EstimationEngine.Optimisation.Optimiser.InDetachedSpace: EstimationEngine.Optimisation.Optimise -&gt; EstimationEngine.Optimisation.Optimiser</div>
<div class="fsdocs-tip" id="fs7">val writeOut: System.Random</div>
<div class="fsdocs-tip" id="fs8">val n: EstimationEngine.WriteOut</div>
<div class="fsdocs-tip" id="fs9">val domain: EstimationEngine.EndCondition</div>
<div class="fsdocs-tip" id="fs10">val f: EstimationEngine.Domain</div>
<div class="fsdocs-tip" id="fs11">val invalidOp: message: string -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs12">val mkContinuous: unit -&gt; EstimationEngine.EstimationEngine&lt;System.DateTime,System.TimeSpan,Time.year,&#39;u&gt;<br /><em>&lt;summary&gt;A basic estimation engine for ordinary differential equations, using a Nelder-Mead optimiser.&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs13">val withCustomOptimisation: optim: EstimationEngine.Optimisation.Optimiser -&gt; engine: EstimationEngine.EstimationEngine&lt;&#39;a,&#39;b,&#39;u,&#39;v&gt; -&gt; EstimationEngine.EstimationEngine&lt;&#39;a,&#39;b,&#39;u,&#39;v&gt;</div>
<div class="fsdocs-tip" id="fs14">namespace Bristlecone.Optimisation</div>
<div class="fsdocs-tip" id="fs15">val settings: MonteCarlo.SimulatedAnnealing.AnnealSettings</div>
<div class="fsdocs-tip" id="fs16">module MonteCarlo

from Bristlecone.Optimisation<br /><em>&lt;summary&gt;
 A module containing Monte Carlo Markov Chain (MCMC) methods for optimisation.
 An introduction to MCMC approaches is provided by
 [Reali, Priami, and Marchetti (2017)](https://doi.org/10.3389/fams.2017.00006)
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs17">module SimulatedAnnealing

from Bristlecone.Optimisation.MonteCarlo<br /><em>&lt;summary&gt;
 A meta-heuristic that approximates a global optimium by
 simulating slow cooling as a slow decrease in the probability
 of temporarily accepting worse solutions.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs18">type AnnealSettings =
  {
    HeatStepLength: EndCondition
    HeatRamp: (float -&gt; float)
    TemperatureCeiling: float option
    BoilingAcceptanceRate: float
    InitialTemperature: float
    PreTuneLength: int&lt;iteration&gt;
    Tuning: TuningSettings
    AnnealStepLength: EndCondition
  }
  static member Default: AnnealSettings with get<br /><em>&lt;summary&gt;
 Represents configurable settings of an annealing procedure
 that supports (a) heating, followed by (b) annealing.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs19">property MonteCarlo.SimulatedAnnealing.AnnealSettings.Default: MonteCarlo.SimulatedAnnealing.AnnealSettings with get</div>
<div class="fsdocs-tip" id="fs20">val classicalSimulatedAnnealing: scale: float&lt;optim-space&gt; -&gt; tDependentProposal: bool -&gt; settings: MonteCarlo.SimulatedAnnealing.AnnealSettings -&gt; EstimationEngine.Optimisation.Optimiser<br /><em>&lt;summary&gt;
 Candidate distribution: Gaussian univariate []
 Probability: Boltzmann Machine
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs21">val fastSimulatedAnnealing: scale: float&lt;optim-space&gt; -&gt; tDependentProposal: bool -&gt; settings: MonteCarlo.SimulatedAnnealing.AnnealSettings -&gt; EstimationEngine.Optimisation.Optimiser<br /><em>&lt;summary&gt;
 Candidate distribution: Cauchy univariate []
 Probability: Bottzmann Machine
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs22">val settingsNM: Amoeba.Solver.Settings</div>
<div class="fsdocs-tip" id="fs23">module Amoeba

from Bristlecone.Optimisation<br /><em>&lt;summary&gt;
 Nelder Mead implementation
 Adapted from original at: https://github.com/mathias-brandewinder/Amoeba
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs24">module Solver

from Bristlecone.Optimisation.Amoeba<br /><em>&lt;summary&gt;
 Nelder–Mead downhill simplex
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs25">val Default: Amoeba.Solver.Settings</div>
<div class="fsdocs-tip" id="fs26">Multiple items<br />val single: EstimationEngine.Optimisation.Optimise<br /><br />--------------------<br />type single = System.Single<br /><br />--------------------<br />type single&lt;&#39;Measure&gt; = float32&lt;&#39;Measure&gt;</div>
<div class="fsdocs-tip" id="fs27">type Optimise = System.Random -&gt; EstimationEngine.WriteOut -&gt; EstimationEngine.EndCondition -&gt; EstimationEngine.Domain -&gt; EstimationEngine.Point option -&gt; EstimationEngine.Objective -&gt; EstimationEngine.Solution list</div>
<div class="fsdocs-tip" id="fs28">val solve: settings: Amoeba.Solver.Settings -&gt; rng: System.Random -&gt; writeOut: (Logging.LogEvent -&gt; unit) -&gt; endCondition: (EstimationEngine.Solution list -&gt; int&lt;iteration&gt; -&gt; EstimationEngine.OptimStopReason) -&gt; domain: (float&lt;optim-space&gt; * float&lt;optim-space&gt; * Parameter.Constraint) array -&gt; &#39;a -&gt; f: EstimationEngine.Objective -&gt; EstimationEngine.Solution list</div>
<div class="fsdocs-tip" id="fs29">val levels: int</div>
<div class="fsdocs-tip" id="fs30">val individuals: int</div>
<div class="fsdocs-tip" id="fs31">val swarm: levels: int -&gt; amoebaAtLevel: int -&gt; settings: Amoeba.Solver.Settings -&gt; EstimationEngine.Optimisation.Optimiser<br /><em>&lt;summary&gt;
 Optimisation heuristic that creates a swarm of amoeba (Nelder-Mead) solvers.
 The swarm proceeds for `numberOfLevels` levels, constraining the starting bounds
 at each level to the 80th percentile of the current set of best likelihoods.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs32">val randomWalk: tuningSteps: TuneStep seq -&gt; EstimationEngine.Optimisation.Optimiser<br /><em>&lt;summary&gt;
 A Markov Chain Monte Carlo (MCMC) sampling algorithm that randomly &#39;walks&#39;
 through a n-dimensional posterior distribution of the parameter space.
 Specify `tuningSteps` to prime the jump size before random walk.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs33">type TuneMethod =
  | Covariance of float
  | Scale
  | CovarianceWithScale of float
  | CovarianceWithScaleTotalHistory of float</div>
<div class="fsdocs-tip" id="fs34">union case TuneMethod.Scale: TuneMethod</div>
<div class="fsdocs-tip" id="fs35">[&lt;Measure&gt;]
type iteration</div>
<div class="fsdocs-tip" id="fs36">module EndConditions

from Bristlecone.Optimisation</div>
<div class="fsdocs-tip" id="fs37">val atIteration: iteration: int&lt;iteration&gt; -&gt; EstimationEngine.Solution list -&gt; currentIteration: int&lt;iteration&gt; -&gt; EstimationEngine.OptimStopReason<br /><em>&lt;summary&gt;
 End the optimisation procedure when a minimum number of iterations is exceeded.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs38">val weighting: float</div>
<div class="fsdocs-tip" id="fs39">val frequency: int&lt;iteration&gt;</div>
<div class="fsdocs-tip" id="fs40">val adaptiveMetropolis: weighting: float -&gt; period: int&lt;iteration&gt; -&gt; EstimationEngine.Optimisation.Optimiser<br /><em>&lt;summary&gt;
 A Markov Chain Monte Carlo (MCMC) sampling algorithm that continually adjusts the
 covariance matrix based on the recently-sampled posterior distribution. Proposed
 jumps are therefore tuned to the recent history of accepted jumps.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs41">module Filzbach

from Bristlecone.Optimisation.MonteCarlo<br /><em>&lt;summary&gt;
 An adaptation of the Filzbach method (originally by Drew Purves)
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs42">val settingsFB: FilzbachSettings</div>
<div class="fsdocs-tip" id="fs43">val filzbach: settings: FilzbachSettings -&gt; EstimationEngine.Optimisation.Optimiser<br /><em>&lt;summary&gt;
 A Monte Carlo Markov Chain sampler based on the &#39;Filzbach&#39; algorithm from
 Microsoft Research Cambridge.
&lt;/summary&gt;</em></div>

    </div>
</main>
<aside id="fsdocs-page-menu">
    <p id="on-this-page">On this page</p>
    <ul>
  <li class="level-1">
    <a href="#Optimisation-Methods">
      Optimisation Methods
    </a>
  </li>
  <li class="level-2">
    <a href="#Defining-a-custom-optimisation-method">
      Defining a custom optimisation method
    </a>
  </li>
  <li class="level-2">
    <a href="#Included-optimisation-methods">
      Included optimisation methods
    </a>
  </li>
  <li class="level-3">
    <a href="#Simulated-Annealing-SA">
      Simulated Annealing (SA)
    </a>
  </li>
  <li class="level-3">
    <a href="#Nelder-Mead-Methods">
      Nelder-Mead Methods
    </a>
  </li>
  <li class="level-3">
    <a href="#Monte-Carlo-methods">
      Monte Carlo methods
    </a>
  </li>
  <li class="level-4">
    <a href="#Random-Walk-Metropolis-Hastings">
      Random Walk Metropolis Hastings
    </a>
  </li>
  <li class="level-4">
    <a href="#Adaptive-Metropolis-AM">
      Adaptive Metropolis (AM)
    </a>
  </li>
  <li class="level-4">
    <a href="#Filzbach-style-Monte-Carlo">
      Filzbach-style Monte Carlo
    </a>
  </li>
  <li class="level-4">
    <a href="#Automatic-optimisation">
      'Automatic' optimisation
    </a>
  </li>
  <li class="level-4">
    <a href="#Adaptive-Metropolis-within-Gibbs">
      Adaptive-Metropolis-within Gibbs
    </a>
  </li>
  <li class="level-4">
    <a href="#Metropolis-within-Gibbs">
      Metropolis-within Gibbs
    </a>
  </li>
</ul>
</aside>
<dialog>
    <input type="search" placeholder="Search docs" />
    <div class="results">
        <ul></ul>
        <p class="empty">Type something to start searching.</p>
    </div>
</dialog>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-tips.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-theme-toggle.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-details-toggle.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-theme.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-search.js"></script>

</body>
</html>