<!DOCTYPE html>
<html lang="en" data-root="https://acm.im/bristlecone/">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Andrew Martin" name="author">
    <!-- Opengraph properties (https://ogp.me/) -->
    <meta property="og:site_name" content="bristlecone">
    <meta property="og:title" content="Writing Models" />
    <meta property="og:url" content="https://acm.im/bristlecone/language.html">
    <meta property="og:type" content="website" />
    <!-- Twitter cards (https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/summary-card-with-large-image) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="https://acm.im/bristlecone/">
    <meta name="twitter:title" content="Writing Models">
    
    <title>Writing Models | bristlecone</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://acm.im/bristlecone/img/favicon.ico" rel="icon" sizes="32x32" type="image/png"/>
    <script type="application/javascript" src="https://acm.im/bristlecone/content/fsdocs-theme-set-dark.js"></script>
    <link href="https://acm.im/bristlecone/content/fsdocs-default.css" rel="stylesheet" type="text/css"/>
    <link href="https://acm.im/bristlecone/content/fsdocs-theme.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.plot.ly/plotly-2.21.0.min.js"></script>
    
</head>
<body class="content">
<header>
    <div class="start">
        <div id="menu-toggle">
            <iconify-icon class="icon closed" height="22" icon="eva:menu-fill" width="22"></iconify-icon>
            <iconify-icon class="icon open" height="22" icon="mi:close" width="22"></iconify-icon>
            <input type="checkbox" name="mobile-menu" />
            <ul class="menu">
                <li class="nav-header">Links</li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/blob/master/LICENSE">License</a>
                </li>
                <li class="nav-item"><a class="nav-link"
                                        href="https://github.com/AndrewIOM/bristlecone/blob/master/RELEASE_NOTES.MD">Release
                    Notes</a></li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/">Source
                    Repository</a></li>
                <li class="nav-header active">
  The Bristlecone Language
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://acm.im/bristlecone/language.html">
    Writing Models
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model.html">
    Defining a Hypothesis (or Model System)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/estimation-engine.html">
    Defining a Model-Fitting Method (Estimation Engine)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/composing-models.html">
    Composing models into many hypotheses
  </a>
</li>             
<li class="nav-header ">
  Techniques
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-fitting.html">
    Model Fitting
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-selection.html">
    Model Selection
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/workflow.html">
    Ensembles and Parallel Processing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/confidence-intervals.html">
    Calculating Confidence Intervals
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/data.html">
    Loading and Saving Data
  </a>
</li>             
<li class="nav-header ">
  Bristlecone.Dendro
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/dendro.html">
    Dendroecology
  </a>
</li>             
<li class="nav-header ">
  Examples
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/predator-prey.html">
    Predator-Prey Dynamics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/shrub-resource.html">
    Shrub response to a single limiting resource
  </a>
</li>             
<li class="nav-header ">
  Components
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/optimisation.html">
    Optimisation
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/integration.html">
    Integration
  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://acm.im/bristlecone/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
        <a href="https://acm.im/bristlecone/">
            <img alt="Header menu logo" src="https://acm.im/bristlecone//img/logo.png">
            <strong>bristlecone</strong>
        </a>
    </div>
    <div class="end">
        <a href="https://github.com/AndrewIOM/bristlecone/" target="_blank">
            <iconify-icon icon="uil:github" width="26" height="26"></iconify-icon>
        </a>
        <iconify-icon id="search-btn" icon="carbon:search" class="search" width="24" height="24"></iconify-icon>
        <fsdocs-theme-toggle></fsdocs-theme-toggle>
    </div>
</header>
<aside id="fsdocs-main-menu">
    <ul class="menu">
        <li class="nav-header">Links</li>
        <li class="nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/blob/master/LICENSE">License</a>
        </li>
        <li class="nav-item"><a class="nav-link"
                                href="https://github.com/AndrewIOM/bristlecone/blob/master/RELEASE_NOTES.MD">Release
            Notes</a></li>
        <li class="nav-item"><a class="nav-link" href="https://github.com/AndrewIOM/bristlecone/">Source
            Repository</a></li>
        <li class="nav-header active">
  The Bristlecone Language
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://acm.im/bristlecone/language.html">
    Writing Models
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model.html">
    Defining a Hypothesis (or Model System)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/estimation-engine.html">
    Defining a Model-Fitting Method (Estimation Engine)
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/composing-models.html">
    Composing models into many hypotheses
  </a>
</li>             
<li class="nav-header ">
  Techniques
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-fitting.html">
    Model Fitting
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/model-selection.html">
    Model Selection
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/workflow.html">
    Ensembles and Parallel Processing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/confidence-intervals.html">
    Calculating Confidence Intervals
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/data.html">
    Loading and Saving Data
  </a>
</li>             
<li class="nav-header ">
  Bristlecone.Dendro
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/dendro.html">
    Dendroecology
  </a>
</li>             
<li class="nav-header ">
  Examples
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/predator-prey.html">
    Predator-Prey Dynamics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/examples/shrub-resource.html">
    Shrub response to a single limiting resource
  </a>
</li>             
<li class="nav-header ">
  Components
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/optimisation.html">
    Optimisation
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://acm.im/bristlecone/integration.html">
    Integration
  </a>
</li>
        <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://acm.im/bristlecone/reference/index.html">
    All Namespaces
  </a>
</li>
    </ul>
</aside>
<main>
    <div id="content">
        
<p><a href="https://acm.im/bristlecone//language.fsx"><img src="https://acm.im/bristlecone//img/badge-script.svg" alt="Script" /></a>&emsp;
<a href="https://acm.im/bristlecone//language.ipynb"><img src="https://acm.im/bristlecone//img/badge-notebook.svg" alt="Notebook" /></a></p>
<h1><a name="The-Bristlecone-Language-Writing-Models" class="anchor" href="#The-Bristlecone-Language-Writing-Models">The Bristlecone Language: Writing Models</a></h1>
<p>Bristlecone includes a language for expressing mathematical models, and combining
these to form hypotheses for testing. You can use the language by opening it's
namespace:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">Bristlecone</span> <span class="c">// Opens Bristlecone core library and estimation engine</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="m">Bristlecone</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="m">Language</span> <span class="c">// Open the language for writing Bristlecone models</span>
</code></pre>
<h2><a name="Writing-mathematical-expressions" class="anchor" href="#Writing-mathematical-expressions">Writing mathematical expressions</a></h2>
<p>In Bristlecone, mathematical expressions to be used within
a model may be written using simple terms. Consider the following
example of an ordinary differential equation of logistic growth:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="id">dNdt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="uc">Parameter</span> <span class="s">&quot;r&quot;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="uc">This</span> <span class="o">*</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="uc">Constant</span> <span class="n">1.</span> <span class="o">-</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="uc">This</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="uc">Parameter</span> <span class="s">&quot;K&quot;</span><span class="pn">)</span><span class="pn">)</span>
</code></pre>
<p>Here, we have used the following model expressions:</p>
<ul>
<li>
<p><code>This</code> - the subject of the equation, which in this
case is <em>N</em>, the population size.</p>
</li>
<li>
<p><code>Parameter</code> - an estimatable parameter followed by its name. Here, we have
defined two parameters:</p>
<ul>
<li><p><code>Paramater "r"</code> - the intrinsic growth rate of the population;</p></li>
<li><p><code>Parameter "K"</code> - the <em>carrying capacity</em> of the population.</p></li>
</ul>
</li>
<li><p><code>Constant</code> - a fixed parameter or constant value within an equation.</p></li>
</ul>
<p>You can use all standard mathematical operators <code>* / + - % **</code> to build your model.
There are additional model expressions that may be used to build up more complex
expressions (which are defined in the <code>ModelExpression</code> discriminated union).</p>
<h2><a name="Additional-model-expressions" class="anchor" href="#Additional-model-expressions">Additional model expressions</a></h2>
<h3><a name="Time-varying-parameters" class="anchor" href="#Time-varying-parameters">Time-varying parameters</a></h3>
<p>Often, a time-series model needs to take account of environmental
variability. For example, changes in temperature and precipitation
may influence the growth rate of a plant over time. Bristlecone supports
time-varying parameters in equations using the form:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="uc">Environment</span> <span class="s">&quot;T[min]&quot;</span>
</code></pre>
<p>Here, we have defined the minimum temperature (<em>T[min]</em>) as a time-varying (or environment) parameter.
Unlike <code>Paramater</code> items, <em>T[min]</em> will not be estimated during model-fitting, but
will be read from the environmental properties for the appropriate time interval.</p>
<h3><a name="Conditional" class="anchor" href="#Conditional">Conditional</a></h3>
<p>You can define a conditional model fragment by using the
<code>Conditional</code> term. A <code>Conditional</code> model expression takes a function
with one argument - a function that represents the future
computation of the model expression (<code>compute</code> -
with signature <code>ModelExpression -&gt; float</code>). Within this function,
you can then evaluate the answer of any model expressions
by passing them as the argument to the <code>compute</code> function.
Please see the below example:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="id">linear</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="uc">Conditional</span><span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="fn">compute</span> <span class="k">-&gt;</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="fn">compute</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs4', 15)" onmouseover="showTip(event, 'fs4', 15)" class="uc">Parameter</span> <span class="s">&quot;a&quot;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs6', 16)" onmouseover="showTip(event, 'fs6', 16)" class="uc">Constant</span> <span class="n">5.</span><span class="pn">)</span> <span class="o">&lt;</span> <span class="n">1e-12</span> <span class="k">then</span>
            <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="uc">Invalid</span>
        <span class="k">else</span>
            <span onmouseout="hideTip(event, 'fs4', 18)" onmouseover="showTip(event, 'fs4', 18)" class="uc">Parameter</span> <span class="s">&quot;a&quot;</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs5', 19)" onmouseover="showTip(event, 'fs5', 19)" class="uc">This</span><span class="pn">)</span>
</code></pre>
<p>In this example, the function is limited such that
the combination of parameter value <em>a</em> with a theoretical
value of <em>This</em> at 5.0 cannot result in an answer that is
less than 1e-12. If this is the case, the result of the
model is <code>Invalid</code>.</p>
<h3><a name="Invalid" class="anchor" href="#Invalid">Invalid</a></h3>
<p>The <code>Invalid</code> keyword is useful in combination with the
<code>Conditional</code> keyword, as demonstrated above. When any model expression
returns <code>Invalid</code>, the model fails. During optimisation, this is useful
to constrain the search within parameter space to values that do not
tend to infinity, or where values may be theoretically implausable.</p>
<h3><a name="Arbitrary" class="anchor" href="#Arbitrary">Arbitrary</a></h3>
<p>Sometimes, a complex sub-model may need to be inserted where you
do not wish to rewrite it into the Bristlecone language. You may also
not have access to the original source, or be calling from an external
library. In these cases, you can use the <code>Arbitrary</code> model expression
to wrap the function for Bristlecone. Helper functions are included
to simplify this process within the <code>Arbitrary</code> module:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// x: population size</span>
<span class="c">/// t: current time</span>
<span class="c">/// z: some environmental value</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="fn">someArbitraryFn</span> <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="fn">x</span> <span onmouseout="hideTip(event, 'fs14', 22)" onmouseover="showTip(event, 'fs14', 22)" class="fn">t</span> <span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="fn">z</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="fn">x</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs14', 25)" onmouseover="showTip(event, 'fs14', 25)" class="fn">t</span> <span class="o">*</span> <span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs15', 26)" onmouseover="showTip(event, 'fs15', 26)" class="fn">z</span>

<span class="c">// TODO Insert example here</span>
</code></pre>
<h3><a name="Time" class="anchor" href="#Time">Time</a></h3>
<p>The <code>Time</code> keyword simply retrives the current time index; as such, it
can be used to formulate time-dependent models.</p>

        <div class="fsdocs-tip" id="fs1">Multiple items<br />module Bristlecone

from Bristlecone<br /><em>&lt;namespacedoc&gt;&lt;summary&gt;The core library of Bristlecone, containing model-fitting functions.&lt;/summary&gt;&lt;/namespacedoc&gt;<br />

 Main functionality of Bristlecone, including functions to scaffold
 `ModelSystem`s and for model-fitting (tests and real fits).
</em><br /><br />--------------------<br />namespace Bristlecone</div>
<div class="fsdocs-tip" id="fs2">module Language

from Bristlecone<br /><em>&lt;summary&gt;
 An F# Domain Specific Language (DSL) for scripting with
 Bristlecone.
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs3">val dNdt: ModelExpression</div>
<div class="fsdocs-tip" id="fs4">Multiple items<br />union case ModelExpression.Parameter: string -&gt; ModelExpression<br /><br />--------------------<br />module Parameter

from Bristlecone</div>
<div class="fsdocs-tip" id="fs5">union case ModelExpression.This: ModelExpression</div>
<div class="fsdocs-tip" id="fs6">union case ModelExpression.Constant: float -&gt; ModelExpression</div>
<div class="fsdocs-tip" id="fs7">union case ModelExpression.Environment: string -&gt; ModelExpression</div>
<div class="fsdocs-tip" id="fs8">val linear: ModelExpression</div>
<div class="fsdocs-tip" id="fs9">union case ModelExpression.Conditional: ((ModelExpression -&gt; float) -&gt; ModelExpression) -&gt; ModelExpression</div>
<div class="fsdocs-tip" id="fs10">val compute: (ModelExpression -&gt; float)</div>
<div class="fsdocs-tip" id="fs11">union case ModelExpression.Invalid: ModelExpression</div>
<div class="fsdocs-tip" id="fs12">val someArbitraryFn: x: float -&gt; t: float -&gt; z: float -&gt; float<br /><em>&#160;x: population size<br />&#160;t: current time<br />&#160;z: some environmental value</em></div>
<div class="fsdocs-tip" id="fs13">val x: float</div>
<div class="fsdocs-tip" id="fs14">val t: float</div>
<div class="fsdocs-tip" id="fs15">val z: float</div>

    </div>
</main>
<aside id="fsdocs-page-menu">
    <p id="on-this-page">On this page</p>
    <ul>
  <li class="level-1">
    <a href="#The-Bristlecone-Language-Writing-Models">
      The Bristlecone Language: Writing Models
    </a>
  </li>
  <li class="level-2">
    <a href="#Writing-mathematical-expressions">
      Writing mathematical expressions
    </a>
  </li>
  <li class="level-2">
    <a href="#Additional-model-expressions">
      Additional model expressions
    </a>
  </li>
  <li class="level-3">
    <a href="#Time-varying-parameters">
      Time-varying parameters
    </a>
  </li>
  <li class="level-3">
    <a href="#Conditional">
      Conditional
    </a>
  </li>
  <li class="level-3">
    <a href="#Invalid">
      Invalid
    </a>
  </li>
  <li class="level-3">
    <a href="#Arbitrary">
      Arbitrary
    </a>
  </li>
  <li class="level-3">
    <a href="#Time">
      Time
    </a>
  </li>
</ul>
</aside>
<dialog>
    <input type="search" placeholder="Search docs" />
    <div class="results">
        <ul></ul>
        <p class="empty">Type something to start searching.</p>
    </div>
</dialog>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-tips.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-theme-toggle.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-theme.js"></script>
<script type="module" src="https://acm.im/bristlecone/content/fsdocs-search.js"></script>

</body>
</html>